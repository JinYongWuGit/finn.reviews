<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Parse Content</title>
</head>
<body>
    <iframe id="contentFrame" width="1200" height="800" style="border:none;"></iframe>

    <script>
        async function fetchAndParseContent() {
            const iframe = document.getElementById('contentFrame');
            const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;

            try {
                const response = await fetch('https://www.finn.no/profile/reviews?userId=1079397917');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const text = await response.text();
                const parser = new DOMParser();
                const doc = parser.parseFromString(text, 'text/html');

                if (doc) {
                    // Prepend 'https://www.finn.no' to any relative links containing 'profile/ads?'
                    const links = doc.querySelectorAll('a[href*="/profile/ads?"]');
                    links.forEach(link => {
                        link.href = 'https://www.finn.no' + link.getAttribute('href');
                        link.target = '_blank';
                    });

                    // Prepend 'https://www.finn.no' to any URL with a number followed by '?userId=1079397917' and target the link to the 'content' div
                    const userIdLinks = doc.querySelectorAll('a[href*="?userId=1079397917"]');
                    userIdLinks.forEach(link => {
                        const href = link.getAttribute('href');
                        if (/\/\d+\?userId=1079397917/.test(href)) {
                            link.href = 'https://www.finn.no' + href;
                            link.target = '_blank';
                        }
                    });

                    iframeDoc.open();
                    iframeDoc.write(`
                        ${doc.body.innerHTML}
                    `);
                    iframeDoc.close();
                }
            } catch (error) {
                console.error('Error fetching or parsing content:', error);
                iframeDoc.open();
                iframeDoc.write(`
                    <html>
                    <head>
                        <style>
                            body {
                                overflow: auto; /* Adds scroll bars */
                            }
                        </style>
                    </head>
                    <body>
                        <img src="https://cdn.shopify.com/s/files/1/0690/6727/6388/files/screencapture-finn-no-profile-reviews-2025-03-14-20_21_29.png?v=1741980467" alt="Fallback Image">
                    </body>
                    </html>
                `);
                iframeDoc.close();
            }
        }

        fetchAndParseContent();
    </script>
</body>
</html>
